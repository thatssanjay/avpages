<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Workout planner</title>

  <style>
    :root{
      --bg1:#e9f6ff;
      --bg2:#f7fbff;
      --card:#ffffff;
      --text:#0b1a2a;
      --muted:#4b6b86;
      --line:rgba(11,26,42,.10);
      --accent:#2f8cff;
      --soft:#dff2ff;
      --chip:#f0f8ff;
      --shadow: 0 14px 40px rgba(17, 74, 132, .12);
      --radius:18px;
      --danger:#ff4d4d;
      --ok:#15b56a;

      /* Ring like your screenshot */
      --ringSize: 92px;
      --ringStroke: 10px;
      --ringBg: rgba(11,26,42,.18);
      --ringYellow: #f2db57;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% 10%, var(--bg1), var(--bg2));
    }

    .app{
      max-width: 980px;
      margin: 0 auto;
      min-height: 100vh;
      display:flex;
      flex-direction:column;
    }

    .header{
      position: sticky;
      top:0;
      z-index: 30;
      background: rgba(255,255,255,.78);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line);
    }
    .headerInner{
      padding: 14px 16px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .brand{display:flex; flex-direction:column; gap:6px;}
    .appTitle{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
      color:#08335f;
    }
    .brand p{
      margin:0;
      color: var(--muted);
      font-size: 12px;
      line-height:1.35;
      max-width: 780px;
    }

    .statusPills{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      border: 1px solid var(--line);
      background: var(--chip);
      color: var(--muted);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background:var(--accent);
      box-shadow:0 0 0 4px rgba(47,140,255,.15);
    }

    /* Day Nav - responsive grid, NO horizontal scroll */
    .dayNavBar{
      position: sticky;
      top: 64px;
      z-index: 25;
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
      padding: 10px 12px;
    }
    .dayGrid{
      display:grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap:8px;
    }
    .dayBtn{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.72);
      border-radius: 16px;
      min-height: 56px;
      cursor:pointer;
      transition: .15s ease;
      padding: 8px 6px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:3px;
    }
    .dayBtn:hover{transform: translateY(-1px); border-color: rgba(47,140,255,.45)}
    .dayBtn.active{
      background: linear-gradient(180deg, rgba(47,140,255,.22), rgba(105,210,255,.10));
      border-color: rgba(47,140,255,.75);
      box-shadow: 0 10px 28px rgba(47,140,255,.18);
    }
    .dow{font-size: 11px; color: var(--muted); letter-spacing: .4px; text-transform: uppercase;}
    .mini{font-size: 12px; font-weight: 950; color: #0a3f7a; text-align:center; line-height:1.1;}

    @media (max-width: 520px){
      .dayGrid{grid-template-columns: repeat(4, minmax(0, 1fr));}
    }

    .content{
      padding: 14px 16px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .dayTitle{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .dayTitle h2{margin:0; font-size: 18px;}
    .dayTitle p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.4;
      max-width: 760px;
    }

    .motivation{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(47,140,255,.22);
      background: linear-gradient(180deg, rgba(47,140,255,.12), rgba(105,210,255,.06));
      color:#0a3f7a;
      font-weight: 950;
      letter-spacing:.15px;
      line-height:1.25;
    }

    .sectionHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
      flex-wrap:wrap;
    }
    .sectionHead h3{margin:0; font-size: 13px; letter-spacing:.2px;}
    .hint{color: var(--muted); font-size: 12px; line-height: 1.35;}

    .steps{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 10px;
    }
    .step{
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 10px;
      background: linear-gradient(180deg, rgba(47,140,255,.06), rgba(105,210,255,.04));
    }

    .stepTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .stepTop .left{
      display:flex;
      gap:10px;
      align-items:center;
      min-width: 260px;
    }
    .badge{
      width: 26px; height: 26px; border-radius: 10px;
      background: rgba(47,140,255,.15);
      border: 1px solid rgba(47,140,255,.25);
      display:flex; align-items:center; justify-content:center;
      font-weight: 950;
      color: #0a3f7a;
      flex: 0 0 auto;
    }
    .stepName{display:flex; flex-direction:column; gap:3px;}
    .stepName b{font-size: 13px;}
    .meta{
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }

    .checkBadge{
      display:none;
      align-items:center;
      gap:6px;
      border: 1px solid rgba(21,181,106,.25);
      background: rgba(21,181,106,.10);
      color:#0b5b37;
      padding: 3px 8px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 11px;
    }
    .checkBadge.show{display:inline-flex;}
    .checkIcon{width: 14px; height: 14px; display:block;}

    .stepActions{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border: 1px solid rgba(47,140,255,.30);
      background: linear-gradient(180deg, rgba(47,140,255,.20), rgba(105,210,255,.12));
      color: #0a3f7a;
      padding: 8px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 900;
      transition: .15s ease;
      font-size: 12px;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(47,140,255,.55)}
    .btn.ghost{
      background: rgba(255,255,255,.65);
      border-color: var(--line);
      color: var(--muted);
    }
    .btn.danger{
      border-color: rgba(255,77,77,.35);
      background: rgba(255,77,77,.12);
      color: #7a0a0a;
    }

    /* Ring timer */
    .timerRow{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top: 6px;
    }
    .ringWrap{
      position: relative;
      width: var(--ringSize);
      height: var(--ringSize);
      flex: 0 0 auto;
    }
    .ringSvg{transform: rotate(-90deg);}
    .ringBg{stroke: var(--ringBg);}
    .ringFg{
      stroke: var(--ringYellow);
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.12));
    }
    .ringFg.done{stroke: var(--ok);}
    .ringText{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      font-weight: 950;
      color:#0b1a2a;
      font-variant-numeric: tabular-nums;
      line-height:1;
      pointer-events:none;
    }
    .ringText small{
      font-size: 10px;
      color: var(--muted);
      font-weight: 800;
      margin-top: 4px;
    }

    table{
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow:hidden;
      border-radius: 16px;
      border: 1px solid var(--line);
    }
    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid var(--line);
      font-size: 13px;
      vertical-align: middle;
    }
    th{
      text-align:left;
      color: var(--muted);
      font-size: 12px;
      background: rgba(47,140,255,.06);
    }
    tr:last-child td{border-bottom:none}

    .qImgs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .qImgWrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      width: 72px;
    }
    .qImg{
      width: 56px;
      height: 56px;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: var(--soft);
      object-fit: cover;
      cursor:pointer;
      transition:.15s ease;
    }
    .qImg:hover{transform: translateY(-1px); border-color: rgba(47,140,255,.55)}
    .qLbl{
      font-size: 10px;
      color: var(--muted);
      text-align:center;
      line-height:1.05;
      max-width: 72px;
    }

    details{
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(47,140,255,.04);
    }
    summary{
      cursor:pointer;
      font-weight: 950;
      color:#0a3f7a;
      outline:none;
    }
    .detailsBody{margin-top:10px; color:#16324b; font-size:13px; line-height:1.5;}

    /* Modal */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(3, 14, 24, .55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 80;
    }
    .modal.show{display:flex;}
    .modalCard{
      width: min(560px, 96vw);
      background: rgba(255,255,255,.95);
      border: 1px solid rgba(255,255,255,.6);
      border-radius: 20px;
      box-shadow: 0 26px 70px rgba(0,0,0,.25);
      overflow:hidden;
      position: relative;
    }
    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(11,26,42,.10);
      gap:10px;
    }
    .modalTop b{font-size: 13px; color:#08335f;}
    .closeBtn{
      border: 1px solid rgba(11,26,42,.12);
      background: rgba(255,255,255,.8);
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 950;
      cursor:pointer;
      color: var(--muted);
    }
    .modalImg{width:100%; height:auto; display:block; background: var(--soft);}
  </style>
</head>

<body>
  <div class="app">

    <div class="header">
      <div class="headerInner">
        <div class="brand">
          <h1 class="appTitle">Smart Workout planner</h1>
          <p>
            Month 1 baseline: <b>40 minutes/day</b>, cardio-first fat burn.
            Alternate days: <b>A</b> = treadmill 30 min focus • <b>B</b> = treadmill 10 + dumbbell + stepper.
            (All GIFs except treadmill)
          </p>
        </div>

        <div class="statusPills">
          <div class="pill"><span class="dot"></span> 40 min/day</div>
          <div class="pill"><span class="dot"></span> 10s beep</div>
          <div class="pill"><span class="dot"></span> Tick on complete</div>
        </div>
      </div>
    </div>

    <div class="dayNavBar">
      <div class="dayGrid" id="nav"></div>
    </div>

    <div class="content">

      <div class="card">
        <div class="dayTitle">
          <div>
            <h2 id="dayTitle">Loading…</h2>
            <p id="dayDesc">Loading…</p>
            <div class="motivation" id="motivation">Loading…</div>
          </div>
          <div class="pill" id="dayMeta">Total: —</div>
        </div>

        <div class="hint" style="margin-top:10px;">
          Talk-test pace = you can talk, not sing. If knee/back pain: reduce speed, avoid jogging.
        </div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <h3>Routine Steps + Timer</h3>
          <div class="hint">Finish → tick ✅ + ring turns green</div>
        </div>
        <div class="steps" id="steps"></div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <h3>Quick Table (GIF for every step except treadmill)</h3>
          <div class="hint">Tap GIF to enlarge. Helps you understand each move.</div>
        </div>
        <table>
          <thead>
            <tr>
              <th style="width:58px;">SN</th>
              <th style="width:280px;">Type of Exe</th>
              <th style="width:90px;">Min</th>
              <th>GIFs (step wise)</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <div class="card">
        <div class="sectionHead">
          <h3>Options (Collapsed)</h3>
          <div class="hint">Open only if needed.</div>
        </div>
        <div id="optionsWrap"></div>
      </div>

    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="imgModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true">
      <div class="modalTop">
        <b id="modalTitle">Preview</b>
        <button class="closeBtn" id="modalClose">Close</button>
      </div>
      <img class="modalImg" id="modalImg" alt="Preview" />
    </div>
  </div>

  <script>
    /*********************
     *  PLAN CONFIG
     *********************/
    function dayTypeForKey(key){
      const A = ["mon","wed","fri","sun"];
      return A.includes(key) ? "A" : "B";
    }

    const OPTIONS_TEXT = {
      A: [
        "If you feel strong: add 1–2% incline in the last 10 minutes.",
        "If you feel tired: brisk walk only (no jog).",
        "Goal: steady sweat, steady breathing."
      ],
      B: [
        "If knees sensitive: chair squats + glute bridges.",
        "If shoulder pain: lighter weight, more rows.",
        "Rest 45–60 sec between sets."
      ]
    };

    const MOTIVATION = {
      mon: "Monday: Start clean. One session = momentum.",
      tue: "Tuesday: Consistency beats intensity. Show up.",
      wed: "Wednesday: Halfway wins. Keep your streak alive.",
      thu: "Thursday: Strong heart, strong mind. Do it.",
      fri: "Friday: Finish the week proud. No excuses.",
      sat: "Saturday: Discipline day. Mood doesn’t matter.",
      sun: "Sunday: Reset the body. Prepare the next week."
    };

    // All GIFs (no treadmill GIF)
    const GIF = {
      warmup_joint_circles: "images/warmup_joint_circles.gif",
      warmup_easy_walk: "images/warmup_easy_walk.gif",

      db_squat: "images/db_squat.gif",
      db_row: "images/db_row.gif",
      db_shoulder_press: "images/db_shoulder_press.gif",
      db_biceps_curl: "images/db_biceps_curl.gif",
      db_triceps_ext: "images/db_triceps_ext.gif",

      stepper: "images/stepper.gif",

      stretch_calf: "images/stretch_calf.gif",
      stretch_hamstring: "images/stretch_hamstring.gif",
      stretch_quad: "images/stretch_quad.gif",
      stretch_chest_opener: "images/stretch_chest_opener.gif",
      stretch_shoulder: "images/stretch_shoulder.gif",
      stretch_back: "images/stretch_back.gif",
      stretch_hip_flexor: "images/stretch_hip_flexor.gif"
    };

    function templateA(){
      return {
        titleSuffix: "Treadmill Focus (Fat Burn)",
        desc: "Warm-up → 30 min treadmill fat-burn → long stretching.",
        steps: [
          {
            slug: "warmup",
            name: "Pre Warm-up (mandatory)",
            min: 5,
            details: [
              "Joint circles: neck/shoulder/hips/knees/ankles (2 min)",
              "Easy walk on treadmill (3 min)"
            ],
            gifKeys: ["warmup_joint_circles","warmup_easy_walk"]
          },
          {
            slug: "treadmill30",
            name: "Treadmill Fat Burn (30 min full focus)",
            min: 30,
            details: [
              "0–5 min: warm walk (comfortable)",
              "5–25 min: brisk walk OR light jog-walk mix (talk-test zone)",
              "25–30 min: fast walk finish (steady breathing)"
            ],
            gifKeys: [] // excluded
          },
          {
            slug: "stretch",
            name: "Post Stretching (longer)",
            min: 5,
            details: [
              "Calf stretch: 45 sec/side",
              "Hamstring stretch: 45 sec/side",
              "Quad stretch: 45 sec/side",
              "Chest opener: 30 sec",
              "Shoulder stretch: 30 sec"
            ],
            gifKeys: ["stretch_calf","stretch_hamstring","stretch_quad","stretch_chest_opener","stretch_shoulder"]
          }
        ]
      };
    }

    function templateB(){
      return {
        titleSuffix: "Treadmill + Dumbbell + Stepper (Fat burn + strength)",
        desc: "Short treadmill + strength circuit + stepper + long stretch.",
        steps: [
          {
            slug: "warmup",
            name: "Pre Warm-up (mandatory)",
            min: 5,
            details: [
              "Joint circles (hips/knees/ankles): 2 min",
              "Easy walk: 3 min"
            ],
            gifKeys: ["warmup_joint_circles","warmup_easy_walk"]
          },
          {
            slug: "treadmill10",
            name: "Treadmill (10 min run/walk)",
            min: 10,
            details: [
              "Walk 3 min",
              "Jog 1 min (optional) + fast walk 2 min",
              "Repeat 2 times"
            ],
            gifKeys: [] // excluded
          },
          {
            slug: "dumbbell15",
            name: "Dumbbell Circuit (15 min) — 2 rounds",
            min: 15,
            details: [
              "Squat: 12 reps",
              "Row: 12 reps/side",
              "Shoulder press: 12 reps",
              "Bicep curls: 15 reps",
              "Triceps extension: 12 reps",
              "Rest 60 sec, repeat 2 rounds"
            ],
            gifKeys: ["db_squat","db_row","db_shoulder_press","db_biceps_curl","db_triceps_ext"]
          },
          {
            slug: "stepper",
            name: "Stepper (fat burn finisher)",
            min: 5,
            details: ["Steady pace 5 min (talk-test zone)"],
            gifKeys: ["stepper"]
          },
          {
            slug: "stretch",
            name: "Post Stretching (longer)",
            min: 5,
            details: [
              "Hamstring: 45 sec/side",
              "Calf: 45 sec/side",
              "Hip flexor/quad: 45 sec/side",
              "Back stretch: 60 sec"
            ],
            gifKeys: ["stretch_hamstring","stretch_calf","stretch_hip_flexor","stretch_back"]
          }
        ]
      };
    }

    const DAYS = [
      { key:"mon", label:"Mon", name:"Monday" },
      { key:"tue", label:"Tue", name:"Tuesday" },
      { key:"wed", label:"Wed", name:"Wednesday" },
      { key:"thu", label:"Thu", name:"Thursday" },
      { key:"fri", label:"Fri", name:"Friday" },
      { key:"sat", label:"Sat", name:"Saturday" },
      { key:"sun", label:"Sun", name:"Sunday" }
    ];

    const PLAN = {};
    for (const d of DAYS){
      const type = dayTypeForKey(d.key);
      const t = (type === "A") ? templateA() : templateB();
      PLAN[d.key] = {
        label: d.label,
        title: `${d.name} — ${type} Day • ${t.titleSuffix}`,
        desc: t.desc,
        type,
        steps: t.steps.map((s, idx) => ({
          ...s,
          sid: `${d.key}-${type}-step-${idx+1}`,
          seconds: s.min * 60
        }))
      };
    }

    /*********************
     *  UI REFS
     *********************/
    const nav = document.getElementById("nav");
    const dayTitle = document.getElementById("dayTitle");
    const dayDesc = document.getElementById("dayDesc");
    const dayMeta = document.getElementById("dayMeta");
    const stepsEl = document.getElementById("steps");
    const tableBody = document.getElementById("tableBody");
    const optionsWrap = document.getElementById("optionsWrap");
    const motivationEl = document.getElementById("motivation");

    /*********************
     *  MODAL
     *********************/
    const imgModal = document.getElementById("imgModal");
    const modalImg = document.getElementById("modalImg");
    const modalTitle = document.getElementById("modalTitle");
    const modalClose = document.getElementById("modalClose");

    function openModal(src, title){
      modalTitle.textContent = title || "Preview";
      modalImg.src = src;
      imgModal.classList.add("show");
      imgModal.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      imgModal.classList.remove("show");
      imgModal.setAttribute("aria-hidden", "true");
      modalImg.src = "";
    }
    modalClose.addEventListener("click", closeModal);
    imgModal.addEventListener("click", (e) => { if(e.target === imgModal) closeModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    /*********************
     *  HELPERS
     *********************/
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function totalMinutes(dayKey){
      return PLAN[dayKey].steps.reduce((sum, s) => sum + (Number(s.min) || 0), 0);
    }
    function fmtTime(sec){
      const s = Math.max(0, Math.floor(sec));
      const mm = String(Math.floor(s / 60)).padStart(2, "0");
      const ss = String(s % 60).padStart(2, "0");
      return `${mm}:${ss}`;
    }
    function ringCircumference(r){ return 2 * Math.PI * r; }

    /*********************
     *  DONE STATE
     *********************/
    function doneKey(sid){ return `done:${sid}`; }
    function isDone(sid){ return localStorage.getItem(doneKey(sid)) === "1"; }
    function setDone(sid, v){
      if(v) localStorage.setItem(doneKey(sid), "1");
      else localStorage.removeItem(doneKey(sid));
    }

    /*********************
     *  ALARM 10s
     *********************/
    const alarmState = { ctx:null, osc:null, gain:null, interval:null, startMs:0 };

    function stopAlarm(){
      try{
        if(alarmState.interval) clearInterval(alarmState.interval);
        alarmState.interval = null;
        if(alarmState.osc) alarmState.osc.stop();
        alarmState.osc = null;
        if(alarmState.ctx) alarmState.ctx.close();
        alarmState.ctx = null;
      }catch(e){}
    }

    function beepAlarm10s(){
      stopAlarm();
      try{
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioCtx();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        osc.type = "sine";
        osc.frequency.value = 880;
        gain.gain.value = 0.0001;

        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();

        alarmState.ctx = ctx;
        alarmState.osc = osc;
        alarmState.gain = gain;
        alarmState.startMs = Date.now();

        // pulse 200ms on / 200ms off
        alarmState.interval = setInterval(() => {
          const elapsed = Date.now() - alarmState.startMs;
          if(elapsed >= 10000){
            stopAlarm();
            return;
          }
          const phase = Math.floor(elapsed / 200) % 2;
          const target = (phase === 0) ? 0.18 : 0.0001;
          gain.gain.setTargetAtTime(target, ctx.currentTime, 0.01);
        }, 50);

      } catch(e){
        alert("Time done!");
      }
      if (navigator.vibrate) navigator.vibrate([250, 120, 250, 120, 250]);
    }

    /*********************
     *  TIMERS
     *********************/
    let activeTimer = null; // { sid, intervalId, remaining, paused }
    const timerState = new Map();

    function stopActiveTimer(){
      if(activeTimer?.intervalId) clearInterval(activeTimer.intervalId);
      activeTimer = null;
    }

    function updateTimerUI(sid){
      const stepEl = document.querySelector(`.step[data-sid="${sid}"]`);
      if(!stepEl) return;

      const total = Number(stepEl.dataset.totalSeconds || 0);
      const remaining = timerState.get(sid) ?? total;

      const text = stepEl.querySelector(".ringText b");
      if(text) text.textContent = fmtTime(remaining);

      const fg = stepEl.querySelector(".ringFg");
      if(fg){
        const r = Number(fg.dataset.r || 0);
        const C = ringCircumference(r);

        if(isDone(sid)){
          fg.classList.add("done");
          fg.style.strokeDasharray = `${C} ${C}`;
          fg.style.strokeDashoffset = `0`;
        } else {
          fg.classList.remove("done");
          const progress = total > 0 ? (remaining / total) : 0;
          const dash = Math.max(0, Math.min(C, C * progress));
          fg.style.strokeDasharray = `${C} ${C}`;
          fg.style.strokeDashoffset = `${C - dash}`;
        }
      }

      const badge = stepEl.querySelector(".checkBadge");
      if(badge) badge.classList.toggle("show", isDone(sid));

      const startBtn = stepEl.querySelector('[data-timer="start"]');
      const pauseBtn = stepEl.querySelector('[data-timer="pause"]');
      const resumeBtn = stepEl.querySelector('[data-timer="resume"]');

      const isThis = activeTimer && activeTimer.sid === sid;
      const isRunning = isThis && !activeTimer.paused;
      const isPaused = isThis && activeTimer.paused;

      if(startBtn) startBtn.disabled = isRunning;
      if(pauseBtn) pauseBtn.disabled = !isThis || isPaused;
      if(resumeBtn) resumeBtn.disabled = !isThis || !isPaused;
    }

    function startTimerForStep(step){
      if(activeTimer && activeTimer.sid !== step.sid) stopActiveTimer();

      let remaining = timerState.get(step.sid);
      if(remaining == null) remaining = step.seconds;

      activeTimer = {
        sid: step.sid,
        remaining,
        paused: false,
        intervalId: setInterval(() => {
          if(!activeTimer || activeTimer.paused) return;

          activeTimer.remaining -= 1;
          timerState.set(step.sid, activeTimer.remaining);
          updateTimerUI(step.sid);

          if(activeTimer.remaining <= 0){
            timerState.set(step.sid, 0);
            setDone(step.sid, true);
            updateTimerUI(step.sid);
            stopActiveTimer();
            beepAlarm10s();
          }
        }, 1000)
      };

      updateTimerUI(step.sid);
    }

    function pauseTimer(sid){
      if(!activeTimer || activeTimer.sid !== sid) return;
      activeTimer.paused = true;
      updateTimerUI(sid);
    }

    function resumeTimer(sid){
      if(!activeTimer || activeTimer.sid !== sid) return;
      activeTimer.paused = false;
      updateTimerUI(sid);
    }

    function resetTimer(step){
      stopAlarm();
      if(activeTimer && activeTimer.sid === step.sid) stopActiveTimer();
      timerState.set(step.sid, step.seconds);
      setDone(step.sid, false);
      updateTimerUI(step.sid);
    }

    /*********************
     *  RENDER
     *********************/
    function renderDay(dayKey){
      const d = PLAN[dayKey];
      dayTitle.textContent = d.title;
      dayDesc.textContent = d.desc;
      dayMeta.textContent = `Total: ${totalMinutes(dayKey)} min • Month 1`;
      motivationEl.textContent = MOTIVATION[dayKey] || "Show up today. That’s the win.";

      // Steps
      stepsEl.innerHTML = d.steps.map((s, idx) => {
        const remaining = timerState.get(s.sid) ?? s.seconds;

        const size = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--ringSize')) || 92;
        const stroke = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--ringStroke')) || 10;
        const r = (size - stroke) / 2;
        const C = ringCircumference(r);

        return `
          <div class="step" data-sid="${s.sid}" data-totalSeconds="${s.seconds}">
            <div class="stepTop">
              <div class="left">
                <div class="badge">${idx+1}</div>
                <div class="stepName">
                  <b>${escapeHtml(s.name)}</b>
                  <div class="meta">
                    ${s.min} min
                    <span class="checkBadge ${isDone(s.sid) ? "show" : ""}">
                      <svg class="checkIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M20 6L9 17l-5-5" stroke="var(--ok)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Done
                    </span>
                  </div>
                </div>
              </div>

              <div class="stepActions">
                <button class="btn" data-timer="start">Start</button>
                <button class="btn ghost" data-timer="pause">Pause</button>
                <button class="btn ghost" data-timer="resume">Resume</button>
                <button class="btn danger" data-timer="reset">Reset</button>
              </div>
            </div>

            <div class="timerRow">
              <div class="ringWrap" aria-label="timer ring">
                <svg class="ringSvg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
                  <circle class="ringBg" cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke-width="${stroke}"></circle>
                  <circle class="ringFg ${isDone(s.sid) ? "done" : ""}" data-r="${r}"
                          cx="${size/2}" cy="${size/2}" r="${r}"
                          fill="none" stroke-width="${stroke}" stroke-linecap="round"
                          style="stroke-dasharray:${C} ${C}; stroke-dashoffset:${C};"></circle>
                </svg>
                <div class="ringText">
                  <b>${fmtTime(remaining)}</b>
                  <small>left</small>
                </div>
              </div>

              <div class="hint" style="max-width:520px;">
                ${(s.details || []).map(x => "• " + escapeHtml(x)).join("<br/>")}
              </div>
            </div>
          </div>
        `;
      }).join("");

      // Quick table: GIFs per step (except treadmill)
      tableBody.innerHTML = d.steps.map((s, i) => {
        let cell = "";

        if (s.slug.startsWith("treadmill")){
          cell = `<span class="hint">No GIF (treadmill)</span>`;
        } else {
          const keys = s.gifKeys || [];
          if(keys.length === 0){
            cell = `<span class="hint">Add GIFs in /images folder</span>`;
          } else {
            cell = `<div class="qImgs">${
              keys.map(k => {
                const src = GIF[k] || "";
                const label = k.replaceAll("_"," ");
                return `
                  <div class="qImgWrap">
                    <img class="qImg"
                         src="${escapeHtml(src)}"
                         alt="${escapeHtml(label)}"
                         data-popup="1"
                         data-title="${escapeHtml(label)}"
                         data-src="${escapeHtml(src)}"
                         onerror="this.style.opacity=0.35; this.title='Missing: ${escapeHtml(src)}';" />
                    <div class="qLbl">${escapeHtml(label)}</div>
                  </div>
                `;
              }).join("")
            }</div>`;
          }
        }

        return `
          <tr>
            <td>${i+1}</td>
            <td>${escapeHtml(s.name)}</td>
            <td>${s.min}</td>
            <td>${cell}</td>
          </tr>
        `;
      }).join("");

      // Options
      const opt = OPTIONS_TEXT[d.type] || [];
      optionsWrap.innerHTML = `
        <details>
          <summary>${d.label} Options (click to open)</summary>
          <div class="detailsBody">
            <ul style="margin:0; padding-left:18px;">
              ${opt.map(x => `<li>${escapeHtml(x)}</li>`).join("")}
            </ul>
          </div>
        </details>
      `;

      // Nav active
      [...nav.querySelectorAll(".dayBtn")].forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.day === dayKey);
      });

      // Update rings now
      d.steps.forEach(s => updateTimerUI(s.sid));
    }

    // Build nav
    for (const d of DAYS){
      const type = dayTypeForKey(d.key);
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "dayBtn";
      btn.dataset.day = d.key;
      btn.innerHTML = `<div class="dow">${d.label}</div><div class="mini">${type} Day</div>`;
      btn.addEventListener("click", () => renderDay(d.key));
      nav.appendChild(btn);
    }

    // Default day from browser
    function dayKeyFromBrowser(){
      const dow = new Date().getDay(); // 0=Sun
      if(dow === 0) return "sun";
      if(dow === 1) return "mon";
      if(dow === 2) return "tue";
      if(dow === 3) return "wed";
      if(dow === 4) return "thu";
      if(dow === 5) return "fri";
      return "sat";
    }

    // Global click handler (timers + modal)
    document.addEventListener("click", (e) => {
      // modal image
      const img = e.target.closest('[data-popup="1"]');
      if(img){
        const src = img.dataset.src || "";
        const title = img.dataset.title || "Preview";
        if(src) openModal(src, title);
        return;
      }

      const stepEl = e.target.closest(".step");
      if(!stepEl) return;

      const active = nav.querySelector(".dayBtn.active");
      const dayKey = active?.dataset.day || dayKeyFromBrowser();

      const sid = stepEl.dataset.sid;
      const step = PLAN[dayKey].steps.find(x => x.sid === sid);
      if(!step) return;

      const timerBtn = e.target.closest("[data-timer]");
      if(timerBtn){
        const t = timerBtn.dataset.timer;
        if(t === "start"){ startTimerForStep(step); return; }
        if(t === "pause"){ pauseTimer(sid); return; }
        if(t === "resume"){ resumeTimer(sid); return; }
        if(t === "reset"){ resetTimer(step); return; }
      }
    });

    // Init
    renderDay(dayKeyFromBrowser());
  </script>
</body>
</html>
